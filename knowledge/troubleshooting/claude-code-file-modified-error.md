---
title: Claude Code "File has been unexpectedly modified" ã‚¨ãƒ©ãƒ¼
category: troubleshooting
tags: [claude-code, windows, bugs, workaround, serena, mcp]
created: 2025-01-19
updated: 2025-01-25
status: active
---

# Claude Code "File has been unexpectedly modified" ã‚¨ãƒ©ãƒ¼

## âš ï¸ æ³¨æ„äº‹é …

**ã“ã‚Œã¯ Claude Code v1.0.111 ã®ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãªãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ãƒã‚°ã§ã™ã€‚**
Edit/Writeãƒ„ãƒ¼ãƒ«ãŒå®Œå…¨ã«ä½¿ç”¨ä¸å¯èƒ½ã«ãªã‚‹ãŸã‚ã€ä»£æ›¿æ‰‹æ®µã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

## Symptoms

Read ãƒ„ãƒ¼ãƒ«ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å–ã£ãŸç›´å¾Œã« Edit/Write ãƒ„ãƒ¼ãƒ«ã§ç·¨é›†ã—ã‚ˆã†ã¨ã™ã‚‹ã¨å¿…ãšå¤±æ•—ã™ã‚‹ã€‚

```
Error: File has been unexpectedly modified. Read it again before attempting to write it.
```

**é‡è¦ãªç‰¹å¾´**:
- æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã®ç·¨é›†ãŒå®Œå…¨ã«ä¸å¯èƒ½ã«ãªã‚‹
- Readãƒ„ãƒ¼ãƒ«ç›´å¾Œã§ã‚‚å¿…ãšå¤±æ•—ã™ã‚‹
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸­ã«ä½œæˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã¯ç·¨é›†å¯èƒ½
- ç’°å¢ƒå¤‰æ•° `CLAUDE_BASH_NO_LOGIN=1` ã‚’è¨­å®šã—ã¦ã‚‚åŠ¹æžœãªã—

## Root Cause

Claude Code v1.0.111 ã§ç™ºç”Ÿã—ãŸã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãªå›žå¸°ãƒã‚°ã€‚Read/Writeãƒ„ãƒ¼ãƒ«é–“ã®ãƒ•ã‚¡ã‚¤ãƒ«çŠ¶æ…‹ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ãŒå®Œå…¨ã«å£Šã‚Œã¦ã„ã‚‹ã€‚

### ç¢ºèªã•ã‚ŒãŸåŽŸå› 

1. **ãƒ•ã‚¡ã‚¤ãƒ«çŠ¶æ…‹ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã®ä¸å…·åˆï¼ˆä¸»è¦å› ï¼‰**
   - Readãƒ„ãƒ¼ãƒ«ãŒæˆåŠŸã—ã¦ã‚‚Edit/Writeãƒ„ãƒ¼ãƒ«ãŒãã®æƒ…å ±ã‚’èªè­˜ã—ãªã„
   - å†…éƒ¨çš„ãªãƒ•ã‚¡ã‚¤ãƒ«çŠ¶æ…‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®åˆæœŸåŒ–ãƒ»åŒæœŸãŒå£Šã‚Œã¦ã„ã‚‹

2. **Windowsç’°å¢ƒã§ã®å•é¡Œï¼ˆç‰¹ã«é¡•è‘—ï¼‰**
   - Git Bashç’°å¢ƒã§ç‰¹ã«å•é¡ŒãŒèµ·ãã‚„ã™ã„
   - ãƒ­ã‚°ã‚¤ãƒ³ã‚·ã‚§ãƒ«å®Ÿè¡Œã«ã‚ˆã‚‹ `.bash_profile` ã®å½±éŸ¿ã‚‚ç–‘ã‚ã‚ŒãŸãŒã€ç’°å¢ƒå¤‰æ•°è¨­å®šã§ã¯è§£æ±ºã›ãš

3. **ç›¸å¯¾ãƒ‘ã‚¹/çµ¶å¯¾ãƒ‘ã‚¹ã«ã‚ˆã‚‹é•ã„**
   - ç›¸å¯¾ãƒ‘ã‚¹ã®æ–¹ãŒæˆåŠŸçŽ‡ãŒé«˜ã„ã¨ã„ã†å ±å‘Šã‚ã‚Šï¼ˆãŸã ã—ç’°å¢ƒä¾å­˜ï¼‰
   - æœ¬è³ªçš„ãªè§£æ±ºç­–ã§ã¯ãªã„

## Solution

### âœ… æœ€å„ªå…ˆ: serena MCP ã® \`replace_content\` ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨

**å•é¡Œç™ºç”Ÿæ™‚ã¯ã™ãã« serena ã‚’ä½¿ã†ã“ã¨ã€‚**

#### 1. serena ã®åˆæœŸåŒ–

```bash
# serena ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–ï¼ˆå¿…é ˆï¼‰
mcp__serena__initial_instructions

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–
mcp__serena__activate_project("project-name")
```

#### 2. ãƒ•ã‚¡ã‚¤ãƒ«ç·¨é›†

serena ã® \`replace_content\` ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ï¼š

```typescript
// æ­£è¦è¡¨ç¾ãƒ¢ãƒ¼ãƒ‰ã§æŸ”è»Ÿã«ç·¨é›†
mcp__serena__replace_content({
  relative_path: "src/shared/lib/tauri.ts",
  needle: "export interface SystemInfo \{[^}]+\}",
  repl: "export interface SystemInfo {\n  // æ›´æ–°å†…å®¹\n}",
  mode: "regex"
})
```

**serena ã®åˆ©ç‚¹**:
- âœ… Claude Code ã®ãƒã‚°ã®å½±éŸ¿ã‚’å—ã‘ãªã„
- âœ… æ­£è¦è¡¨ç¾ã«ã‚ˆã‚‹æŸ”è»Ÿãªç·¨é›†ãŒå¯èƒ½
- âœ… ã‚·ãƒ³ãƒœãƒ«ãƒ¬ãƒ™ãƒ«ã®ç·¨é›†ã«ã‚‚å¯¾å¿œ
- âœ… å¤§è¦æ¨¡ãªãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã«é©ã—ã¦ã„ã‚‹

### âš ï¸ éžæŽ¨å¥¨: sed/cat ã§ã®å›žé¿ç­–

```bash
# sed ã‚’ä½¿ã£ãŸç›´æŽ¥ç·¨é›†ï¼ˆåŠ¹çŽ‡ãŒæ‚ªã„ï¼‰
sed -i 's/old/new/g' file.ts

# cat heredoc ã§ã®æ›¸ãè¾¼ã¿ï¼ˆåŠ¹çŽ‡ãŒæ‚ªã„ï¼‰
cat > file.ts << 'EOF'
content here
EOF
```

**é¿ã‘ã‚‹ã¹ãç†ç”±**:
- âŒ éžåŠ¹çŽ‡ï¼ˆç‰¹ã«å¤§ããªãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
- âŒ ã‚¨ãƒ©ãƒ¼å‡¦ç†ãŒä¸å®Œå…¨
- âŒ ã‚³ãƒ¼ãƒ‰ã®å¯èª­æ€§ãŒä½Žä¸‹
- âŒ åž‹ãƒã‚§ãƒƒã‚¯ãŒã§ããªã„

### ðŸ“‹ å•é¡Œè§£æ±ºãƒ•ãƒ­ãƒ¼

Edit/Writeãƒ„ãƒ¼ãƒ«ãŒå¤±æ•—ã—ãŸå ´åˆã®æŽ¨å¥¨æ‰‹é †ï¼š

1. **ã¾ãš GitHub Issues ã‚’ç¢ºèª** â†’ ãƒã‚°ä¿®æ­£ç‰ˆãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
2. **serena ã‚’åˆæœŸåŒ–** â†’ \`mcp__serena__initial_instructions\` ã¨ \`activate_project\`
3. **serena ã® \`replace_content\` ã§ç·¨é›†** â†’ æ­£è¦è¡¨ç¾ã‚’æ´»ç”¨
4. **sed/cat ã¯æœ€çµ‚æ‰‹æ®µ** â†’ serena ã§ã‚‚è§£æ±ºã§ããªã„å ´åˆã®ã¿

## Verification

ä»¥ä¸‹ã®ãƒ†ã‚¹ãƒˆã§å•é¡ŒãŒè§£æ¶ˆã•ã‚ŒãŸã‹ç¢ºèªï¼š

1. **æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿å–ã‚Š**:

   ```
   Read: src/shared/lib/tauri.ts
   ```

2. **å³åº§ã«ç·¨é›†ã‚’è©¦è¡Œ**:

   ```
   Edit: src/shared/lib/tauri.tsï¼ˆã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ ãªã©ç°¡å˜ãªå¤‰æ›´ï¼‰
   ```

3. **å¤±æ•—ã™ã‚‹å ´åˆ**:
   - ã™ãã« serena ã«åˆ‡ã‚Šæ›¿ãˆã‚‹
   - sed/cat ã§ã®å›žé¿ã¯é¿ã‘ã‚‹

## Prevention

### å®Ÿè£…æ™‚ã®åŽŸå‰‡

1. **å•é¡Œç™ºç”Ÿæ™‚ã¯æ ¹æœ¬åŽŸå› ã‚’èª¿ã¹ã‚‹**
   - sed/cat ã«é€ƒã’ã‚‹å‰ã« GitHub Issues ã‚’æ¤œç´¢
   - \`.bash_profile\` ç­‰ã®ç’°å¢ƒè¨­å®šã‚’ç–‘ã†å‰ã«ãƒã‚°å ±å‘Šã‚’ç¢ºèª

2. **serena ã‚’ç©æ¥µçš„ã«æ´»ç”¨**
   - åˆæœŸåŒ–æ‰‹é †ã‚’ç†è§£ã—ã¦ãŠã
   - \`replace_content\` ã®æ­£è¦è¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç¿’å¾—

3. **åŠ¹çŽ‡é‡è¦–**
   - sed/cat ã¯éžåŠ¹çŽ‡ãªã®ã§é¿ã‘ã‚‹
   - serena ã¯åž‹å®‰å…¨ã§åŠ¹çŽ‡çš„

### çŸ­æœŸçš„å¯¾ç­–ï¼ˆãƒã‚°ä¿®æ­£ã¾ã§ï¼‰

- âœ… **serena ã‚’æ¨™æº–ã®ç·¨é›†ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦ä½¿ç”¨**
- âœ… GitHub Issue #7443, #10882, #11684 ç­‰ã‚’å®šæœŸçš„ã«ãƒã‚§ãƒƒã‚¯
- âš ï¸ Claude Code ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–°æƒ…å ±ã‚’ç¢ºèª

### é•·æœŸçš„å¯¾ç­–ï¼ˆãƒã‚°ä¿®æ­£å¾Œï¼‰

- Claude Code ã®æœ€æ–°ç‰ˆã¸ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ
- Edit/Write ãƒ„ãƒ¼ãƒ«ã®å‹•ä½œç¢ºèª
- serena ã¯å¼•ãç¶šãå¤§è¦æ¨¡ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ç”¨ã«ä½¿ç”¨

## Related Issues

- [GitHub #7443](https://github.com/anthropics/claude-code/issues/7443) - ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãƒã‚°å ±å‘Šï¼ˆãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ï¼‰
- [GitHub #10882](https://github.com/anthropics/claude-code/issues/10882) - VSCodeæ‹¡å¼µã§ã®å¤±æ•—
- [GitHub #7918](https://github.com/anthropics/claude-code/issues/7918) - Windowsç’°å¢ƒã§ã®å•é¡Œ
- [GitHub #11463](https://github.com/anthropics/claude-code/issues/11463) - ã‚¨ãƒ©ãƒ¼ãƒ«ãƒ¼ãƒ—
- [GitHub #10437](https://github.com/anthropics/claude-code/issues/10437) - Readç›´å¾Œã®Editå¤±æ•—
- [GitHub #11684](https://github.com/anthropics/claude-code/issues/11684) - Git Bashç’°å¢ƒ

## References

- [serena MCP](https://github.com/oraios/serena) - ã‚»ãƒžãƒ³ãƒ†ã‚£ãƒƒã‚¯ã‚³ãƒ¼ãƒ‰ç·¨é›†ãƒ„ãƒ¼ãƒ«
- [GitHub Issue #7443](https://github.com/anthropics/claude-code/issues/7443) - ãƒ¡ã‚¤ãƒ³ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°Issue
- [Mediumè¨˜äº‹](https://medium.com/@yunjeongiya/the-elusive-claude-file-has-been-unexpectedly-modified-bug-a-workaround-solution-831182038d1d) - å›žé¿ç­–ã®ã¾ã¨ã‚

## ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±

- **ç™ºç”Ÿãƒãƒ¼ã‚¸ãƒ§ãƒ³**: Claude Code v1.0.111ã€œ
- **æœ€çµ‚å‹•ä½œãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v1.0.100
- **èª¿æŸ»æ—¥**: 2025-01-19, 2025-01-25ï¼ˆæ›´æ–°ï¼‰
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãƒã‚°ï¼ˆæ ¹æœ¬ä¿®æ­£å¾…ã¡ï¼‰ã€serena ã§å›žé¿å¯èƒ½

## å­¦ã‚“ã æ•™è¨“

1. **å•é¡Œè§£æ±ºã®åŽŸå‰‡ã‚’å®ˆã‚‹**
   - å¯¾ç—‡ç™‚æ³•ï¼ˆsed/catï¼‰ã«èµ°ã‚‰ãªã„
   - æ ¹æœ¬åŽŸå› ã‚’èª¿æŸ»ã™ã‚‹ï¼ˆGitHub Issuesæ¤œç´¢ï¼‰
   - åŠ¹çŽ‡çš„ãªä»£æ›¿æ‰‹æ®µã‚’æŽ¢ã™ï¼ˆserenaï¼‰

2. **serena ã®æœ‰ç”¨æ€§**
   - ãƒã‚°å›žé¿ã ã‘ã§ãªãã€é€šå¸¸ã®é–‹ç™ºã§ã‚‚æœ‰ç”¨
   - æ­£è¦è¡¨ç¾ã«ã‚ˆã‚‹æŸ”è»Ÿãªç·¨é›†
   - ã‚·ãƒ³ãƒœãƒ«ãƒ¬ãƒ™ãƒ«ã®æ“ä½œãŒå¯èƒ½

3. **ç’°å¢ƒå¤‰æ•°è¨­å®šã®é™ç•Œ**
   - \`CLAUDE_BASH_NO_LOGIN=1\` ã¯åŠ¹æžœãªã—
   - ãƒ„ãƒ¼ãƒ«å†…éƒ¨ã®ãƒã‚°ã¯ç’°å¢ƒè¨­å®šã§ã¯è§£æ±ºã§ããªã„
